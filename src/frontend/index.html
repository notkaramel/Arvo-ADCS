<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arvo ADCS</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-3xl p-6 bg-white rounded-2xl shadow-lg space-y-4">
      <!-- Instruction Input -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Instruction</label>
        <input
          id="instructionInput"
          type="text"
          placeholder="e.g. deploy to AWS with containers and a Postgres DB"
          class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- File Upload -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Upload ZIP</label>
        <input
          id="zipUpload"
          type="file"
          accept=".zip"
          class="block w-full text-sm text-gray-600 file:mr-3 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-600 hover:file:bg-blue-100 active:file:bg-blue-200 hover:cursor-pointer hover:file:cursor-pointer"
        />
      </div>

      <!-- Button -->
      <button
        id="sendBtn"
        class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-xl shadow hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        Send Request
      </button>

      <!-- Backend Logs -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Backend Logs</label>
        <textarea
          id="logs"
          rows="8"
          readonly
          class="w-full p-3 border border-gray-300 rounded-xl font-mono text-sm bg-gray-50"
        ></textarea>
      </div>
    </div>

    <!-- Script -->
    <script>
      // Check backend health on load
      window.onload = async () => {
        const logsBox = document.getElementById("logs");
        logsBox.value += "Checking backend health...\n";
        try {
          const res = await fetch("http://localhost:8080/health");
          if (res.ok) {
            logsBox.value += "Backend is healthy!\n";
          } else {
            logsBox.value += "Backend health check failed.\n";
          }
        } catch (err) {
          logsBox.value += `Error: ${err.message}\n`;
        }
      };

      // Handle button click
      document.getElementById("sendBtn").addEventListener("click", async () => {
        const instruction = document.getElementById("instructionInput").value;
        const fileInput = document.getElementById("zipUpload");
        const logsBox = document.getElementById("logs");

        if (!instruction && fileInput.files.length === 0) {
          alert("Please enter an instruction and/or upload a zip file.");
          return;
        }

        const formData = new FormData();
        formData.append("instruction", instruction);
        if (fileInput.files.length > 0) {
          formData.append("repo_zip", fileInput.files[0]);
        }

        logsBox.value += "Sending request...\n";

        try {
          const res = await fetch("http://localhost:8080/upload", {
            method: "POST",
            body: formData, 
          });
          const data = await res.text();
          logsBox.value += `Response: ${data}\n`;
        } catch (err) {
          logsBox.value += `Error: ${err.message}\n`;
        }
      });
    </script>
  </body>
</html>
